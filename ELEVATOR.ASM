LJMP MAIN

ORG 03H
LJMP PERSONINTERRUPT

ORG 13H
LJMP OPENINTERRUPT

ORG 93H
LJMP DATAINTERRUPT


ORG 9BH
LJMP MAININTERRUPT



PERSONINTERRUPT :



RETI

OPENINTERRUPT :
LCALL Open5
RETI


DATAINTERRUPT :



RETI


MAININTERRUPT :

	LCALL ZERO_UP_DOWN
LOOP:
	;JUMP TO LOOP IF PERSON > 4

	LCALL UP_DOWN
	LCALL OPEN_O_NOT	
	LCALL CLEAR_ORDER
	LCALL Servo
	LCALL SETFLOOR
	LCALL OPEN_O_NOT	
	LCALL CLEAR_ORDER


	
	;JUMP TO LOOP IF REGISTERS NOT EQUAL ZERO

	RETI


RETI

;OUR FUNCYIONS
Open5:
			JB P2.0,ENDOFOPEN5  ;PINS OF SERVO IS ON P2.0,P2.1
			JB P2.1,ENDOFOPEN5
			SETB P2.2	    ;PINS OF SERVO OF THE DOOR IS ON P2.2,P2.3
			LCALL Delay         ;DELAY SOME TIME
			CLR P2.2
			LCALL Delay5	    ;DELAY 5 SECONDS
			SETB P2.3
			LCALL Delay
			CLR P2.3
			ENDOFOPEN5:
			RET	

Delay5:
MOV CKCON,#00H //нн TIMCLC = SYSCLK/12

				//LOAD EACH INITIAL VALUE TO the auto-reload register ( L AND H )
				MOV RCAP2L,#00H 
				MOV RCAP2H,#00H

				//LOAD START VALUE 
				MOV TL2,#00H
				MOV TH2,#00H

				//LOAD COUNTER VALUE
				MOV R5,#00H

				//16 Bit Timer with Auto-reload , SRART TIMER
				MOV T2CON,#00000100B
 
				FIVE_SEC_DELAY:	
												COUNTER : JNB T2CON.7,COUNTER
												CLR T2CON.7 
												INC R5
												CJNE R5,#66H,FIVE_SEC_DELAY

				//AFTER FINISH 5 SEC , STOP TIMER AND CLEAR FLAG
				CLR T2CON.2
				CLR T2CON.7
				MOV R5,#00H

				RET

Delay:

;;;;;;;;SOMELOGIC
	
	RET


Servo:
	MOV P2.0,00H  ;UP FLAG IS STORED IN 00H PIN
	MOV P2.1,01H  ;DOWN FLAG IS STORED IN 01H PIN
	ACALL Delay
	CLR P2.0
	CLR P2.1
	RET


OPEN_OR_NOT:
					;JUMP TO END_OF_OPEN_OR_NOT IF 
					LCALL Open5
					END_OF_OPEN_OR_NOT: RET		


ZERO_UP_DOWN :

					;SOME LOGIC

					RET


UP_DOWN :

					;SOME LOGIC

					RET


SETFLOOR :

					;SOMELOGIC


					RET

CLEAR_ORDER :

					;SOME LOGIC

					RET



MAIN:

;ENABLE INTERUPTS
MOV IE,#10000101B ;Enable External INT1,INT0
MOV EIE2,#00110000B;ENABLE 6,7

MOV IP,00000101B    ;INT0,INT1 PRIPRITY HIGH
MOV EIP2,00010000B  ;6 PRIORITY HIGH

;SET MODE OF PORTS




HERE : SJMP HERE

END